<!DOCTYPE html>
<html>
<head>
  <title>Teste WhatsApp API</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
    input, button { padding: 10px; margin: 10px 0; width: 100%; box-sizing: border-box; }
    button { background: #25D366; color: white; border: none; cursor: pointer; font-size: 16px; }
    button:hover { background: #128C7E; }
    .result { margin-top: 20px; padding: 15px; border-radius: 5px; white-space: pre-wrap; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ Teste WhatsApp Business API</h1>

    <h3>1. Verificar Token</h3>
    <button onclick="verificarToken()">‚úÖ Verificar se Token est√° V√°lido</button>
    <div id="resultToken"></div>

    <hr style="margin: 30px 0;">

    <h3>2. Enviar Mensagem de Teste</h3>
    <input type="text" id="phone" placeholder="N√∫mero (ex: 5548996372539)" value="5548996372539">
    <input type="text" id="message" placeholder="Mensagem" value="üöÄ Teste do NexTalk Desk!">
    <button onclick="enviarMensagem()">üì§ Enviar Mensagem</button>
    <div id="resultMessage"></div>

    <hr style="margin: 30px 0;">

    <div class="info">
      <strong>‚ÑπÔ∏è Importante:</strong>
      <ul>
        <li>Token tempor√°rio expira em 24h</li>
        <li>N√∫mero precisa estar cadastrado na Meta</li>
        <li>Verifique se est√° no modo de teste</li>
      </ul>
    </div>
  </div>

  <script>
    const PHONE_NUMBER_ID = "823581997515238";
    const ACCESS_TOKEN = "EAAKNtwS6kTsBQBZAyPjNyVKE6FS2cZBejdZA9ym0T8d9adKf58Yyxo8M9R5ZA6PmduFQa4c8YZA7a4JgASeIhk5D8YywmOm6To81BdmdcKat35ZBBqMkTHzP2cOCeVgCFiY2LTUDCRNMk7ZAdVcZCJChuoM713LbrKBSQ38iksbfbeTArQ4CyfzzYzxT7GvrsuOp87ICDmwIycvXOHnaRkwgU4GAPlEr4VBdiIp2nn82SgAY5j8ESx8bRQxrbxeL2ZAk9tV2Gbc55l22PWQu3sw1g";

    async function verificarToken() {
      const resultDiv = document.getElementById('resultToken');
      resultDiv.innerHTML = '<div class="info">‚è≥ Verificando...</div>';

      try {
        const response = await fetch(`https://graph.facebook.com/v19.0/${PHONE_NUMBER_ID}`, {
          headers: {
            'Authorization': `Bearer ${ACCESS_TOKEN}`
          }
        });

        const data = await response.json();

        if (response.ok) {
          resultDiv.innerHTML = `<div class="success">
‚úÖ TOKEN V√ÅLIDO!

Informa√ß√µes do N√∫mero:
${JSON.stringify(data, null, 2)}
          </div>`;
        } else {
          resultDiv.innerHTML = `<div class="error">
‚ùå TOKEN INV√ÅLIDO OU EXPIRADO!

Erro: ${data.error.message}
C√≥digo: ${data.error.code}

üîß Solu√ß√£o: Gere um novo token em:
https://developers.facebook.com/apps/718767151288635/whatsapp-business/wa-dev-console/
          </div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Erro de rede: ${error.message}</div>`;
      }
    }

    async function enviarMensagem() {
      const phone = document.getElementById('phone').value;
      const message = document.getElementById('message').value;
      const resultDiv = document.getElementById('resultMessage');

      if (!phone || !message) {
        resultDiv.innerHTML = '<div class="error">‚ùå Preencha todos os campos!</div>';
        return;
      }

      resultDiv.innerHTML = '<div class="info">‚è≥ Enviando...</div>';

      try {
        const response = await fetch(`https://graph.facebook.com/v19.0/${PHONE_NUMBER_ID}/messages`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${ACCESS_TOKEN}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            messaging_product: "whatsapp",
            to: phone,
            type: "text",
            text: { body: message }
          })
        });

        const data = await response.json();

        if (response.ok) {
          resultDiv.innerHTML = `<div class="success">
‚úÖ MENSAGEM ENVIADA COM SUCESSO!

ID da mensagem: ${data.messages[0].id}
Status: ${data.messages[0].message_status || 'Enviada'}

Verifique seu WhatsApp: ${phone}
          </div>`;
        } else {
          let errorMsg = data.error.message;
          let solution = '';

          if (data.error.code === 190) {
            solution = 'üîß Solu√ß√£o: Token expirado. Gere um novo em developers.facebook.com';
          } else if (data.error.error_subcode === 2388003) {
            solution = `üîß Solu√ß√£o: Cadastre o n√∫mero ${phone} na lista de testes da Meta`;
          }

          resultDiv.innerHTML = `<div class="error">
‚ùå ERRO AO ENVIAR!

Mensagem: ${errorMsg}
C√≥digo: ${data.error.code}

${solution}

Detalhes completos:
${JSON.stringify(data, null, 2)}
          </div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">‚ùå Erro de rede: ${error.message}</div>`;
      }
    }
  </script>
</body>
</html>
